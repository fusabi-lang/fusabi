# I/O Operations

Fusabi provides modules for file operations, terminal I/O, shell commands, and system interaction.

## Terminal Output

### Basic Printing

```fsharp
// Print without newline
print "Hello"
print " World"

// Print with newline
printfn "Hello, World!"
```

### Formatted Output

```fsharp
let name = "Alice"
let age = 30

// Build formatted strings
let message = String.concat [
    "Name: "; name; "\n";
    "Age: "; "30"; "\n"
]
print message
```

## Process Module

Run shell commands and interact with the system:

### Running Shell Commands

```fsharp
// examples/system_demo.fsx
let result = Process.runShell "echo 'Hello from shell!'"

// Access the output
let stdout = result.stdout
let exitCode = result.exitCode
```

### Current Working Directory

```fsharp
let cwd = Process.cwd ()
print cwd
```

### Environment Variables

```fsharp
// Returns Option - might not exist
let pathVar = Process.env "PATH"

match pathVar with
| Some path -> print path
| None -> print "PATH not set"

// Or use Option.defaultValue
let home = Option.defaultValue "/tmp" (Process.env "HOME")
```

## Time Module

Work with timestamps and formatting:

### Current Time

```fsharp
// Milliseconds since Unix epoch
let nowMs = Time.now ()

// Seconds since Unix epoch
let nowSec = Time.nowSeconds ()
```

### Formatting Time

```fsharp
let timestamp = Time.now ()
let formatted = Time.format "%Y-%m-%d %H:%M:%S" timestamp
print formatted  // "2024-03-15 14:30:45"
```

### Parsing Time

```fsharp
// Returns Option
let parsed = Time.parse "%Y-%m-%d" "2024-03-15"
```

### Measuring Duration

```fsharp
let start = Time.now ()

// ... do some work ...
let numbers = List.map (fun x -> x * 2) [1; 2; 3; 4; 5]

let elapsed = Time.now () - start
print "Elapsed: "
print elapsed
print " ms\n"
```

## URL Module

Parse and manipulate URLs:

### Parsing URLs

```fsharp
// examples/system_demo.fsx
let urlString = "https://example.com:8080/api/users?page=2#results"
let parsed = Url.parse urlString
```

### Validating URLs

```fsharp
let isValid1 = Url.isValid "https://github.com/fusabi-lang"  // true
let isValid2 = Url.isValid "not-a-valid-url"                 // false
```

### URL Encoding/Decoding

```fsharp
let query = "hello world & special chars!"
let encoded = Url.encode query  // "hello%20world%20%26%20special%20chars%21"
let decoded = Url.decode encoded  // Back to original
```

## Math Module

Mathematical operations for calculations:

```fsharp
// Constants
let pi = Math.pi ()

// Trigonometry
let sine = Math.sin (pi / 2.0)    // 1.0
let cosine = Math.cos 0.0          // 1.0

// Other operations
let root = Math.sqrt 16.0          // 4.0
let power = Math.pow 2.0 10.0      // 1024.0
let absolute = Math.abs (-42)      // 42
let maximum = Math.max 10 20       // 20
let minimum = Math.min 10 20       // 10
```

### Practical Example: Distance Calculation

```fsharp
let distance x1 y1 x2 y2 =
    let dx = x2 - x1
    let dy = y2 - y1
    Math.sqrt (dx * dx + dy * dy)

let d = distance 0.0 0.0 3.0 4.0  // 5.0
```

## Result Module

Handle success and failure cases:

```fsharp
// Create Result values
let success = Ok 42
let failure = Error "Something went wrong"

// Check type
let isOk = Result.isOk success      // true
let isError = Result.isError failure // true

// Get value with default
let value = Result.defaultValue 0 failure  // 0

// Chain operations
let parsePositive x =
    if x > 0 then Ok (x * 2)
    else Error "Must be positive"

let chained = Result.bind parsePositive (Ok 5)  // Ok 10
```

### Safe Division Example

```fsharp
let safeDivide a b =
    if b = 0 then Error "Division by zero"
    else Ok (a / b)

let result1 = safeDivide 10 2   // Ok 5
let result2 = safeDivide 10 0   // Error "Division by zero"

let value = Result.defaultValue 0 result2  // 0
```

## Combining Modules

### System Information Display

```fsharp
let showSystemInfo () =
    let cwd = Process.cwd ()
    let time = Time.format "%Y-%m-%d %H:%M:%S" (Time.now ())
    let home = Option.defaultValue "unknown" (Process.env "HOME")

    String.concat [
        "=== System Info ===\n";
        "Current dir: "; cwd; "\n";
        "Time: "; time; "\n";
        "Home: "; home; "\n"
    ]

print (showSystemInfo ())
```

### Timed Command Execution

```fsharp
let timedCommand cmd =
    let start = Time.now ()
    let result = Process.runShell cmd
    let elapsed = Time.now () - start

    String.concat [
        "Command: "; cmd; "\n";
        "Output: "; String.trim result.stdout; "\n";
        "Duration: "; elapsed; "ms\n"
    ]

print (timedCommand "date")
```

### URL Processing Pipeline

```fsharp
let processUrl urlString =
    if Url.isValid urlString then
        let parsed = Url.parse urlString
        Ok parsed
    else
        Error "Invalid URL"

match processUrl "https://example.com/api" with
| Ok url -> print "Valid URL processed"
| Error msg -> print msg
```

## Summary

Fusabi provides these I/O modules:

| Module | Purpose |
|--------|---------|
| `print`/`printfn` | Terminal output |
| `Process` | Shell commands, cwd, env vars |
| `Time` | Timestamps, formatting, parsing |
| `Url` | URL parsing, validation, encoding |
| `Math` | Mathematical operations |
| `Result` | Error handling |

These modules enable building practical applications that interact with the system while maintaining functional programming principles.
